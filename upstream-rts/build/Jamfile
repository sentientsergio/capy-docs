#
# Copyright (c) 2025 Mohammad Nejati
#
# Distributed under the Boost Software License, Version 1.0. (See accompanying
# file LICENSE_1_0.txt or copy at http://www.boost.org/LICENSE_1_0.txt)
#
# Official repository: https://github.com/cppalliance/rts
#

import ac ;
import config : requires ;

constant c11-requires :
    [ requires
    cxx11_constexpr
    cxx11_decltype
    cxx11_hdr_tuple
    cxx11_template_aliases
    cxx11_variadic_templates
    ]
    ;

path-constant RTS_ROOT : .. ;

project boost/rts
  : requirements
    $(c11-requires)
    <define>BOOST_RTS_SOURCE
  : common-requirements
    <link>shared:<define>BOOST_RTS_DYN_LINK
    <link>static:<define>BOOST_RTS_STATIC_LINK
  : usage-requirements
    <define>BOOST_RTS_NO_LIB
  : source-location $(RTS_ROOT)
  ;

alias rts_sources : [ glob-tree-ex ./src : *.cpp ] ;

lib boost_rts
  : rts_sources
  : requirements
  : usage-requirements
  ;

# Zlib
using zlib ;

alias rts_zlib_sources : [ glob-tree-ex ./src_zlib : *.cpp ] ;

lib boost_rts_zlib
  : rts_zlib_sources
  : requirements
    <library>/boost/rts//boost_rts
    [ ac.check-library /zlib//zlib : <library>/zlib//zlib : <build>no ]
  : usage-requirements
    <library>/boost/rts//boost_rts
    <define>BOOST_RTS_HAS_ZLIB
  ;

# Brotli
using brotli ;

alias rts_brotli_sources : [ glob-tree-ex ./src_brotli : *.cpp ] ;

lib boost_rts_brotli
  : rts_brotli_sources
  : requirements
    <library>/boost/rts//boost_rts
    [ ac.check-library /brotli//brotlicommon : <library>/brotli//brotlicommon : <build>no ]
    [ ac.check-library /brotli//brotlidec : <library>/brotli//brotlidec : <build>no ]
    [ ac.check-library /brotli//brotlienc : <library>/brotli//brotlienc : <build>no ]
  : usage-requirements
    <library>/boost/rts//boost_rts
    <define>BOOST_RTS_HAS_BROTLI
  ;

boost-install boost_rts boost_rts_zlib boost_rts_brotli ;
